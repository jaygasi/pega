import { Meta, Primary, Controls, Story } from '@storybook/addon-docs/blocks';
import * as DemoStories from './demo.stories';

<Meta of={DemoStories} />

# Overview

This field-level component extends a standard text input with dynamic emoji display functionality. The component shows emojis next to the input field based on the current value, using a configurable JSON mapping of status values to emojis.

**Key Features:**
- âœ… **Dynamic Emoji Display** - Automatically shows emojis based on input value
- âœ… **JSON Configuration** - Flexible emoji mapping through configuration
- âœ… **Case-insensitive Matching** - Works with "failed", "Failed", or "FAILED"
- âœ… **Multiple Display Modes** - Supports edit, display-only, and labels-left modes
- âœ… **Error Handling** - Gracefully handles invalid JSON configurations
- âœ… **Enhanced Input Handling** - Advanced state management with onBlur/onKeyDown events
- âœ… **Validation Support** - Built-in validation message and helper text support
- âœ… **Keyboard Navigation** - Enter key triggers field changes
- âœ… **Responsive Design** - Optimized emoji sizing for different display modes
- âœ… **Pega Integration** - Follows Constellation design patterns

<Primary />

## Props

<Controls />

## Configuration

### Basic Setup

1. **Add the component** to your form or view
2. **Configure the label** and placeholder text
3. **Set up emoji configuration** using the JSON format below
4. **Bind to a property** that contains status values

### Emoji Configuration JSON Format

The component uses a JSON configuration to map status values to emojis:

```json
{
  "status_emojis": [
    {
      "status": "Completed",
      "emoji": "âœ…"
    },
    {
      "status": "In Progress", 
      "emoji": "â³"
    },
    {
      "status": "Pending",
      "emoji": "ğŸ•’"
    },
    {
      "status": "Failed",
      "emoji": "âŒ"
    },
    {
      "status": "Cancelled",
      "emoji": "ğŸš«"
    },
    {
      "status": "On Hold",
      "emoji": "â¸ï¸"
    }
  ]
}
```

### Configuration Properties

| Property | Type | Description | Example |
|----------|------|-------------|---------|
| **label** | Text | Field label display text | "Project Status" |
| **placeholder** | Text | Input placeholder text | "Enter status..." |
| **emojiConfig** | Textarea (JSON) | JSON mapping of status to emoji | See JSON format above |
| **required** | Boolean | Makes the field required | true/false |
| **disabled** | Boolean | Disables the input field | true/false |
| **readOnly** | Boolean | Makes the field read-only | true/false |

### Usage Examples

#### 1. Project Status Field
```json
{
  "status_emojis": [
    {"status": "Not Started", "emoji": "ğŸ”´"},
    {"status": "In Progress", "emoji": "ğŸŸ¡"},
    {"status": "Review", "emoji": "ğŸ”µ"}, 
    {"status": "Completed", "emoji": "ğŸŸ¢"}
  ]
}
```

#### 2. Order Status Field
```json
{
  "status_emojis": [
    {"status": "Ordered", "emoji": "ğŸ“¦"},
    {"status": "Processing", "emoji": "âš™ï¸"},
    {"status": "Shipped", "emoji": "ğŸšš"},
    {"status": "Delivered", "emoji": "âœ…"},
    {"status": "Cancelled", "emoji": "âŒ"}
  ]
}
```

#### 3. Priority Levels
```json
{
  "status_emojis": [
    {"status": "Low", "emoji": "ğŸŸ¢"},
    {"status": "Medium", "emoji": "ğŸŸ¡"},
    {"status": "High", "emoji": "ğŸŸ "},
    {"status": "Critical", "emoji": "ğŸ”´"}
  ]
}
```

### Behavior

- **Case Insensitive**: "completed", "Completed", "COMPLETED" all match the same emoji
- **No Match**: If no status matches, only the text is displayed without an emoji
- **Invalid JSON**: If the JSON configuration is invalid, the component logs a warning and continues without emojis
- **Real-time Updates**: Emoji updates immediately as the user types or when the value changes programmatically

### Display Modes

The component supports all standard Pega display modes:

- **Edit Mode**: Shows input field with emoji alongside
- **Display Only**: Shows value with emoji (no input field)
- **Labels Left**: Shows label on left with value and emoji on right
- **Stacked Large**: Shows large text value with emoji

### Best Practices

1. **Keep status values consistent** - Use the same casing and spelling across your application
2. **Choose recognizable emojis** - Select emojis that clearly represent the status meaning
3. **Test configurations** - Validate your JSON before deploying
4. **Document status values** - Maintain a list of valid status values for your team
5. **Consider accessibility** - Emojis are decorative; ensure status is clear from text alone

### Enhanced Input Handling

This component includes advanced input handling features for improved user experience:

#### State Management
- **Internal State Sync**: Maintains internal input state that syncs with external value changes
- **Change Tracking**: Tracks user interaction to optimize server communication
- **Immediate Visual Feedback**: Updates emoji display instantly as user types

#### Keyboard Support
- **Enter Key**: Pressing Enter triggers field change and server update
- **Tab Navigation**: Proper blur handling ensures changes are saved when leaving field
- **Accessibility**: Full keyboard navigation support

#### Validation Integration
- **Helper Text**: Supports display of helpful hints below the input
- **Validation Messages**: Shows validation errors with proper styling
- **Error States**: Visual indicators for invalid input

### Troubleshooting

**Emoji not showing?**
- Check that the input value exactly matches a status in your configuration
- Verify the JSON configuration is valid
- Check browser console for any error messages

**Input not updating properly?**
- Ensure the component is bound to a valid property
- Check that the property has appropriate access permissions
- Verify network connectivity for server updates

**JSON configuration errors?**
- Validate your JSON syntax using an online JSON validator
- Ensure all status and emoji fields are properly quoted strings
- Check that the structure matches the required format exactly