import { Meta, Primary, Controls, Story } from '@storybook/addon-docs/blocks';
import * as DemoStories from './demo.stories';

<Meta of={DemoStories} />

# Text Input with Search

A robust text input component with integrated search functionality, featuring enhanced icon positioning and comprehensive input handling capabilities.

## Overview

This field-level component extends a standard text input with search capabilities. It includes a search icon button that triggers server-side processing and can communicate with PDF viewers for text highlighting.

**Key Features:**
- ✅ **Integrated Search** - Built-in search icon button for triggering searches
- ✅ **PDF Integration** - Communicates with PDF viewers for text highlighting
- ✅ **Enhanced Icon Positioning** - Perfectly aligned search icon with smooth animations
- ✅ **Robust State Management** - Advanced input handling with proper change tracking
- ✅ **Keyboard Support** - Full accessibility and keyboard navigation
- ✅ **Server Integration** - Triggers server-side search processing
- ✅ **Event Dispatching** - Custom events for PDF viewer communication
- ✅ **Responsive Design** - Adapts to different screen sizes and contexts
- ✅ **Validation Support** - Built-in validation and helper text display
- ✅ **Pega Integration** - Follows Constellation design patterns

<Primary />

## Props

<Controls />

## Configuration

### Basic Setup

1. **Add the component** to your form or view
2. **Configure the label** and placeholder text
3. **Set the search property reference** to enable search functionality
4. **Bind to a property** that contains the search text

### Search Integration

#### Server-Side Search

The component integrates with Pega's server-side search capabilities:

- **Search Property Reference**: Configure `searchPropRef` to specify which property triggers the search
- **Field Change API**: Uses `triggerFieldChange` to communicate with the server
- **Immediate Processing**: Search is triggered when the search button is clicked

#### PDF Viewer Integration

The component can communicate with PDF viewers on the page:

- **Custom Events**: Dispatches `simplePdfViewerSearch` events
- **Programmatic API**: Calls `window.simplePdfViewer.search()` when available
- **Fallback Handling**: Gracefully handles missing viewer components

### Enhanced UI Features

#### Icon Positioning

The search icon features enhanced positioning and visual feedback:

- **Perfect Alignment**: Centered positioning with fine-tuned transforms
- **Smooth Animations**: Hover effects with scale transitions
- **Consistent Sizing**: Standardized button dimensions (32x32px)
- **Visual States**: Clear disabled and active states

#### Responsive Behavior

- **Flexible Layout**: Input field grows to fill available space
- **Proper Spacing**: Consistent gap between input and button
- **Mobile Friendly**: Optimized for touch interactions

### Usage Patterns

#### Document Search

Perfect for searching within documents or PDF files:

```jsx
<TextInputSearch
  label="Search Document"
  placeholder="Enter search terms..."
  searchPropRef="DocumentSearchText"
/>
```

#### Data Filtering

Use for filtering large datasets:

```jsx
<TextInputSearch
  label="Filter Results"
  placeholder="Type to filter..."
  searchPropRef="FilterCriteria"
/>
```

#### Content Discovery

Ideal for finding specific content:

```jsx
<TextInputSearch
  label="Find Content"
  placeholder="What are you looking for?"
  searchPropRef="ContentSearchQuery"
/>
```

### Advanced Features

#### State Management

- **Internal State Tracking**: Maintains search text state independently
- **Change Detection**: Only triggers searches when text has actually changed
- **Sync Handling**: Automatically syncs with external value updates

#### Event Handling

- **Button Click**: Primary search trigger
- **Enter Key**: Alternative search activation (future enhancement)
- **Focus Management**: Proper keyboard navigation support

#### Error Handling

- **Graceful Degradation**: Continues working even if PDF integration fails
- **Debug Logging**: Console debug messages for troubleshooting
- **Fallback Events**: Multiple communication methods for PDF viewers

### Styling and Theming

The component uses Cosmos React Core styling with enhanced CSS:

- **Flexbox Layout**: Modern layout with proper alignment
- **CSS Transforms**: Fine-tuned positioning adjustments
- **Transition Effects**: Smooth hover and focus animations
- **Consistent Spacing**: Standardized margins and padding

### Accessibility

- **Screen Reader Support**: Proper ARIA labels and roles
- **Keyboard Navigation**: Full keyboard accessibility
- **Focus Management**: Clear focus indicators
- **Button Labels**: Descriptive button text for screen readers

### Best Practices

1. **Clear Placeholders** - Use descriptive placeholder text to guide users
2. **Proper Labels** - Always include accessible labels
3. **Search Scope** - Make it clear what will be searched
4. **Response Feedback** - Provide feedback when search is triggered
5. **Empty States** - Handle cases where no search results are found

### Troubleshooting

**Search not working?**
- Verify `searchPropRef` is configured correctly
- Check that the referenced property exists and is accessible
- Ensure server-side search logic is properly configured

**PDF integration not working?**
- Check browser console for debug messages
- Verify PDF viewer is loaded and available
- Ensure `simplePdfViewerSearch` event listeners are registered

**Icon alignment issues?**
- Component now includes enhanced positioning - should be resolved
- Check for CSS conflicts with other components
- Verify Cosmos React Core styles are loading correctly

### Migration Notes

This component has been enhanced with improved icon positioning. If upgrading from a previous version:

- ✅ **Icon Alignment**: Now perfectly centered with fine-tuned transforms
- ✅ **Better Animations**: Smooth hover effects and transitions
- ✅ **Consistent Sizing**: Standardized button dimensions
- ✅ **No Breaking Changes**: All existing functionality preserved